<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BitMagic-C++: xsample05.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">BitMagic-C++
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">xsample05.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment">Copyright(c) 2018 Anatoliy Kuznetsov(anatoliy_kuznetsov at yahoo.com)</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></div><div class="line"><span class="comment">you may not use this file except in compliance with the License.</span></div><div class="line"><span class="comment">You may obtain a copy of the License at</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">    http://www.apache.org/licenses/LICENSE-2.0</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">Unless required by applicable law or agreed to in writing, software</span></div><div class="line"><span class="comment">distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></div><div class="line"><span class="comment">WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></div><div class="line"><span class="comment">See the License for the specific language governing permissions and</span></div><div class="line"><span class="comment">limitations under the License.</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">For more information please visit:  http://bitmagic.io</span></div><div class="line"><span class="comment">*/</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/** \example xsample05.cpp</span></div><div class="line"><span class="comment">*/</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/*! \file xsample05.cpp</span></div><div class="line"><span class="comment">    \brief Example: Example on how to use bit-transposed string sparse vector</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">    Illustrates how to build a sparse vector, serialize it to disk,</span></div><div class="line"><span class="comment">    load back and do search or binary hybrid search.</span></div><div class="line"><span class="comment"> </span></div><div class="line"><span class="comment">  \sa bm::str_sparse_vector&lt;&gt;</span></div><div class="line"><span class="comment">   </span></div><div class="line"><span class="comment">*/</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;sstream&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;chrono&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;regex&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;time.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;vector&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;map&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;chrono&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;map&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;utility&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;algorithm&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;random&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacestd.html">std</a>;</div><div class="line"></div><div class="line"><span class="comment">//#define BMAVX2OPT</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="bm_8h.html">bm.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="bmalgo_8h.html">bmalgo.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="bmserial_8h.html">bmserial.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="bmrandom_8h.html">bmrandom.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="bmstrsparsevec_8h.html">bmstrsparsevec.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="bmsparsevec__algo_8h.html">bmsparsevec_algo.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="bmsparsevec__serial_8h.html">bmsparsevec_serial.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="bmalgo__similarity_8h.html">bmalgo_similarity.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="bmsparsevec__util_8h.html">bmsparsevec_util.h</a>&quot;</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;bmdbg.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="bmtimer_8h.html">bmtimer.h</a>&quot;</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/// Print help</span></div><div class="line"><span class="comment"></span><span class="keyword">static</span></div><div class="line"><span class="keywordtype">void</span> <a name="a0"></a><a class="code" href="xsample05_8cpp.html#a81962ff36a3740bd2a6a458b74e57e26">show_help</a>()</div><div class="line">{</div><div class="line">    std::cerr</div><div class="line">        &lt;&lt; <span class="stringliteral">&quot;BitMagic Dictionary Search Sample (c) 2018&quot;</span> &lt;&lt; std::endl</div><div class="line">        &lt;&lt; <span class="stringliteral">&quot;-idict  file-name            -- input set file to parse&quot;</span> &lt;&lt; std::endl</div><div class="line">        &lt;&lt; <span class="stringliteral">&quot;-svout  spase vector output  -- sparse vector name to save&quot;</span> &lt;&lt; std::endl</div><div class="line">        &lt;&lt; <span class="stringliteral">&quot;-svin   sparse vector input  -- sparse vector file name to load &quot;</span> &lt;&lt; std::endl</div><div class="line">        &lt;&lt; <span class="stringliteral">&quot;-diag                        -- run diagnostics&quot;</span>                  &lt;&lt; std::endl</div><div class="line">        &lt;&lt; <span class="stringliteral">&quot;-bench                       -- run benchmarks&quot;</span>                   &lt;&lt; std::endl</div><div class="line">        &lt;&lt; <span class="stringliteral">&quot;-timing                      -- collect timings&quot;</span>                  &lt;&lt; std::endl</div><div class="line">      ;</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// Arguments</span></div><div class="line"><span class="comment">//</span></div><div class="line">std::string  <a name="a1"></a><a class="code" href="xsample05_8cpp.html#aaf0266ddaa79e04e2229808d9dabf477">sv_out_name</a>;</div><div class="line">std::string  <a name="a2"></a><a class="code" href="xsample05_8cpp.html#a501736bde7958b6e05f5fa0f5ca954c1">sv_in_name</a>;</div><div class="line">std::string  <a name="a3"></a><a class="code" href="xsample05_8cpp.html#ac7177de84eadf5aefd08c81cd1425d20">i_name</a>;</div><div class="line"><span class="keywordtype">bool</span>         <a name="a4"></a><a class="code" href="xsample05_8cpp.html#aa592d3fbead57ca8423ac5caaccada07">is_diag</a> = <span class="keyword">false</span>;</div><div class="line"><span class="keywordtype">bool</span>         <a name="a5"></a><a class="code" href="xsample05_8cpp.html#aece8e90d91aaea144d41103f7d2825ee">is_timing</a> = <span class="keyword">false</span>;</div><div class="line"><span class="keywordtype">bool</span>         <a name="a6"></a><a class="code" href="xsample05_8cpp.html#a4dd1e4b402061691109d356faa4513b5">is_bench</a> = <span class="keyword">false</span>;</div><div class="line"></div><div class="line"><span class="comment">// Parse command line arguments</span></div><div class="line"><span class="keyword">static</span></div><div class="line"><span class="keywordtype">int</span> <a name="a7"></a><a class="code" href="xsample05_8cpp.html#a1c6cda197a32141227af69a440929ac6">parse_args</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div><div class="line">{</div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt; argc; ++i)</div><div class="line">    {</div><div class="line">        std::string arg = argv[i];</div><div class="line">        <span class="keywordflow">if</span> ((arg == <span class="stringliteral">&quot;-h&quot;</span>) || (arg == <span class="stringliteral">&quot;--help&quot;</span>))</div><div class="line">        {</div><div class="line">            <a class="code" href="xsample05_8cpp.html#a81962ff36a3740bd2a6a458b74e57e26">show_help</a>();</div><div class="line">            <span class="keywordflow">return</span> 0;</div><div class="line">        }</div><div class="line">        </div><div class="line">        <span class="keywordflow">if</span> (arg == <span class="stringliteral">&quot;-svout&quot;</span> || arg == <span class="stringliteral">&quot;--svout&quot;</span>)</div><div class="line">        {</div><div class="line">            <span class="keywordflow">if</span> (i + 1 &lt; argc)</div><div class="line">            {</div><div class="line">                <a class="code" href="xsample05_8cpp.html#aaf0266ddaa79e04e2229808d9dabf477">sv_out_name</a> = argv[++i];</div><div class="line">            }</div><div class="line">            <span class="keywordflow">else</span></div><div class="line">            {</div><div class="line">                std::cerr &lt;&lt; <span class="stringliteral">&quot;Error: -svout requires file name&quot;</span> &lt;&lt; std::endl;</div><div class="line">                <span class="keywordflow">return</span> 1;</div><div class="line">            }</div><div class="line">            <span class="keywordflow">continue</span>;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (arg == <span class="stringliteral">&quot;-svin&quot;</span> || arg == <span class="stringliteral">&quot;--svin&quot;</span>)</div><div class="line">        {</div><div class="line">            <span class="keywordflow">if</span> (i + 1 &lt; argc)</div><div class="line">            {</div><div class="line">                <a class="code" href="xsample05_8cpp.html#a501736bde7958b6e05f5fa0f5ca954c1">sv_in_name</a> = argv[++i];</div><div class="line">            }</div><div class="line">            <span class="keywordflow">else</span></div><div class="line">            {</div><div class="line">                std::cerr &lt;&lt; <span class="stringliteral">&quot;Error: -svin requires file name&quot;</span> &lt;&lt; std::endl;</div><div class="line">                <span class="keywordflow">return</span> 1;</div><div class="line">            }</div><div class="line">            <span class="keywordflow">continue</span>;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (arg == <span class="stringliteral">&quot;-idict&quot;</span> || arg == <span class="stringliteral">&quot;--idict&quot;</span> )</div><div class="line">        {</div><div class="line">            <span class="keywordflow">if</span> (i + 1 &lt; argc)</div><div class="line">            {</div><div class="line">                <a class="code" href="xsample05_8cpp.html#ac7177de84eadf5aefd08c81cd1425d20">i_name</a> = argv[++i];</div><div class="line">            }</div><div class="line">            <span class="keywordflow">else</span></div><div class="line">            {</div><div class="line">                std::cerr &lt;&lt; <span class="stringliteral">&quot;Error: -idict requires file name&quot;</span> &lt;&lt; std::endl;</div><div class="line">                <span class="keywordflow">return</span> 1;</div><div class="line">            }</div><div class="line">            <span class="keywordflow">continue</span>;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (arg == <span class="stringliteral">&quot;-diag&quot;</span> || arg == <span class="stringliteral">&quot;--diag&quot;</span> || arg == <span class="stringliteral">&quot;-d&quot;</span> || arg == <span class="stringliteral">&quot;--d&quot;</span>)</div><div class="line">        {</div><div class="line">            <a class="code" href="xsample05_8cpp.html#aa592d3fbead57ca8423ac5caaccada07">is_diag</a> = <span class="keyword">true</span>;</div><div class="line">            <span class="keywordflow">continue</span>;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">if</span> (arg == <span class="stringliteral">&quot;-timing&quot;</span> || arg == <span class="stringliteral">&quot;--timing&quot;</span> || arg == <span class="stringliteral">&quot;-t&quot;</span> || arg == <span class="stringliteral">&quot;--t&quot;</span>)</div><div class="line">        {</div><div class="line">            <a class="code" href="xsample05_8cpp.html#aece8e90d91aaea144d41103f7d2825ee">is_timing</a> = <span class="keyword">true</span>;</div><div class="line">            <span class="keywordflow">continue</span>;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">if</span> (arg == <span class="stringliteral">&quot;-bench&quot;</span> || arg == <span class="stringliteral">&quot;--bench&quot;</span> || arg == <span class="stringliteral">&quot;-b&quot;</span> || arg == <span class="stringliteral">&quot;--b&quot;</span>)</div><div class="line">        {</div><div class="line">            <a class="code" href="xsample05_8cpp.html#a4dd1e4b402061691109d356faa4513b5">is_bench</a> = <span class="keyword">true</span>;</div><div class="line">            <span class="keywordflow">continue</span>;</div><div class="line">        }</div><div class="line">        </div><div class="line">        std::cerr &lt;&lt; <span class="stringliteral">&quot;Error: unknown argument: &quot;</span> &lt;&lt; arg &lt;&lt; std::endl;</div><div class="line">        <span class="keywordflow">return</span> 1;</div><div class="line"></div><div class="line"></div><div class="line">    } <span class="comment">// for i</span></div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// Global types</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="keyword">typedef</span> <a name="_a8"></a><a class="code" href="classbm_1_1str__sparse__vector.html">bm::str_sparse_vector&lt;char, bm::bvector&lt;&gt;</a>, 64&gt;  <a name="a9"></a><a class="code" href="xsample05_8cpp.html#af8ccf32d064bd78f22207c06f233375e">str_sparse_vect</a>;</div><div class="line"><span class="keyword">typedef</span> vector&lt;string&gt;  <a name="a10"></a><a class="code" href="xsample05_8cpp.html#a8bf4fb8d6965a6d2b5da8c388f625171">string_vector</a>;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><a class="code" href="classbm_1_1chrono__taker.html#add1676592117ed0eaa2fa6279a71b46a">bm::chrono_taker::duration_map_type</a>  <a name="a11"></a><a class="code" href="xsample05_8cpp.html#a6cb51d150528a5d2d87acb3e88f450bc">timing_map</a>;</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/// Parse the input file and extract dictionary values.</span></div><div class="line"><span class="comment">/// </span></div><div class="line"><span class="comment"></span><span class="keyword">static</span></div><div class="line"><span class="keywordtype">int</span> <a name="a12"></a><a class="code" href="xsample05_8cpp.html#aa7970d5724e5b12f07307f86645d7214">load_dict_report</a>(<span class="keyword">const</span> std::string&amp; fname, <a class="code" href="xsample05_8cpp.html#a8bf4fb8d6965a6d2b5da8c388f625171">string_vector</a>&amp; str_vec)</div><div class="line">{</div><div class="line">    <a name="_a13"></a><a class="code" href="classbm_1_1chrono__taker.html">bm::chrono_taker</a> tt1(<span class="stringliteral">&quot;1. parse input data &quot;</span>, 1, &amp;<a class="code" href="xsample05_8cpp.html#a6cb51d150528a5d2d87acb3e88f450bc">timing_map</a>);</div><div class="line"></div><div class="line">    std::ifstream fin(fname.c_str(), std::ios::in);</div><div class="line">    <span class="keywordflow">if</span> (!fin.good())</div><div class="line">        <span class="keywordflow">return</span> -1;</div><div class="line"></div><div class="line">    std::string line;</div><div class="line">    std::regex reg(<span class="stringliteral">&quot;[|]&quot;</span>);</div><div class="line">    std::sregex_token_iterator it_end;</div><div class="line">    </div><div class="line">    <span class="keywordtype">string</span> trim_chars(<span class="stringliteral">&quot;\&quot; &quot;</span>);</div><div class="line"></div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; std::getline(fin, line); ++i)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">if</span> (line.empty() || !isdigit(line.front()))</div><div class="line">            <span class="keywordflow">continue</span>;</div><div class="line"></div><div class="line">        <span class="comment">// regex based tokenizer</span></div><div class="line">        std::sregex_token_iterator it(line.begin(), line.end(), reg, -1);</div><div class="line">        std::vector&lt;std::string&gt; line_vec(it, it_end);</div><div class="line">        <span class="keywordflow">if</span> (line_vec.empty())</div><div class="line">            <span class="keywordflow">continue</span>;</div><div class="line">        <span class="keywordflow">try</span></div><div class="line">        {</div><div class="line">            <span class="comment">// trip the extra chars</span></div><div class="line">            <span class="keywordtype">string</span>&amp; col13 = line_vec.at(13);</div><div class="line">            col13.erase(0, col13.find_first_not_of(trim_chars));</div><div class="line">            col13.erase(col13.find_last_not_of(trim_chars) + 1);</div><div class="line"></div><div class="line">            <span class="keywordflow">if</span> (!col13.empty())</div><div class="line">                str_vec.emplace_back(col13);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">catch</span> (std::exception&amp;)</div><div class="line">        {</div><div class="line">            <span class="comment">// just ignore (not ideal, but ok for a sketch ETL)</span></div><div class="line">        }</div><div class="line">        <span class="keywordflow">if</span> (i % 10000 == 0)</div><div class="line">        {</div><div class="line">            cout &lt;&lt; <span class="stringliteral">&quot;\rReading input file: &quot;</span> &lt;&lt; i &lt;&lt; flush;</div><div class="line">        }</div><div class="line">    } <span class="comment">// for</span></div><div class="line">    cout &lt;&lt; endl;</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/// Compare STL vector with bit-transposed container to check correcness</span></div><div class="line"><span class="comment">///</span></div><div class="line"><span class="comment"></span><span class="keyword">static</span></div><div class="line"><span class="keywordtype">void</span> <a name="a14"></a><a class="code" href="xsample05_8cpp.html#aba487d142b2efb5cd5e143c7c9fa9c6a">check_sparse</a>(<span class="keyword">const</span> <a class="code" href="classbm_1_1str__sparse__vector.html">str_sparse_vect</a>&amp; str_sv, <span class="keyword">const</span> <a class="code" href="xsample05_8cpp.html#a8bf4fb8d6965a6d2b5da8c388f625171">string_vector</a>&amp; str_vec)</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span> (str_vec.size() != str_sv.<a name="a15"></a><a class="code" href="classbm_1_1str__sparse__vector.html#a8c07aff1f17d07156fc65c1d7d7436f5">size</a>())</div><div class="line">        <span class="keywordflow">throw</span> runtime_error(<span class="stringliteral">&quot;Error. size() comparison failed!&quot;</span>);</div><div class="line">    <span class="keywordtype">string</span> s;</div><div class="line">    <span class="keywordflow">for</span> (<a class="code" href="classbm_1_1str__sparse__vector.html#a3571a8772d22d500a0b06acf9fe00134">str_sparse_vect::size_type</a> i = 0; i &lt; str_sv.<a class="code" href="classbm_1_1str__sparse__vector.html#a8c07aff1f17d07156fc65c1d7d7436f5">size</a>(); ++i)</div><div class="line">    {</div><div class="line">        str_sv.<a name="a16"></a><a class="code" href="classbm_1_1str__sparse__vector.html#ac532119542ae9d702d2f26889f53384c">get</a>(i, s);</div><div class="line">        <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; s_control = str_vec[i];</div><div class="line">        <span class="keywordflow">if</span> (s != s_control)</div><div class="line">            <span class="keywordflow">throw</span> runtime_error(<span class="stringliteral">&quot;Error. element comparison failed!&quot;</span>);</div><div class="line">    } <span class="comment">// for</span></div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Check ok. Dictionary size = &quot;</span> &lt;&lt; str_sv.<a class="code" href="classbm_1_1str__sparse__vector.html#a8c07aff1f17d07156fc65c1d7d7436f5">size</a>() &lt;&lt; std:: endl;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">const</span> <span class="keywordtype">unsigned</span> <a name="a17"></a><a class="code" href="xsample05_8cpp.html#acfa82a881bc9254866a0c6971e2cb1cf">benchmark_max</a> = 15000;  <span class="comment">// benchmark sampling size</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/// Sample a few random terms out of collection</span></div><div class="line"><span class="comment"></span><span class="keyword">static</span></div><div class="line"><span class="keywordtype">void</span> <a name="a18"></a><a class="code" href="xsample05_8cpp.html#ab67e6b44ea8f9b8ae182b3e7173f1b51">pick_benchmark_set</a>(<a class="code" href="xsample05_8cpp.html#a8bf4fb8d6965a6d2b5da8c388f625171">string_vector</a>&amp; bench_vec, <a class="code" href="xsample05_8cpp.html#a8bf4fb8d6965a6d2b5da8c388f625171">string_vector</a>&amp; bench_vec_not_found, <span class="keyword">const</span> <a class="code" href="xsample05_8cpp.html#a8bf4fb8d6965a6d2b5da8c388f625171">string_vector</a>&amp; str_vec)</div><div class="line">{</div><div class="line">    std::random_device <a name="a19"></a><a class="code" href="sample11_8cpp.html#a4d7cf7e96896f9aebdd79fed7c8bab7b">rand_dev</a>;</div><div class="line">    std::mt19937 <a name="a20"></a><a class="code" href="sample11_8cpp.html#a9b287f91e2adf83c3131895cd6e07195">gen</a>(<a class="code" href="sample11_8cpp.html#a4d7cf7e96896f9aebdd79fed7c8bab7b">rand_dev</a>()); <span class="comment">// mersenne_twister_engine </span></div><div class="line">    std::uniform_int_distribution&lt;unsigned&gt; <a name="a21"></a><a class="code" href="sample11_8cpp.html#a8ae0e64af654605402aa541a12f3cb88">rand_dis</a>(0, <span class="keywordtype">unsigned</span>(str_vec.size()-1)); <span class="comment">// generate uniform numebrs for [1, vector_max]</span></div><div class="line"></div><div class="line">    <a name="_a22"></a><a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a> bv;</div><div class="line">    </div><div class="line">    bench_vec.<a name="a23"></a><a class="code" href="classbm_1_1bvector.html#a56b7573c759e51c8943cf95a82a5b9d6">resize</a>(0);</div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; <a class="code" href="xsample05_8cpp.html#acfa82a881bc9254866a0c6971e2cb1cf">benchmark_max</a>; ++i)</div><div class="line">    {</div><div class="line">        <span class="keywordtype">unsigned</span> idx;</div><div class="line">        <span class="keywordflow">while</span> (<span class="keyword">true</span>)</div><div class="line">        {</div><div class="line">            idx = unsigned(<a class="code" href="sample11_8cpp.html#a8ae0e64af654605402aa541a12f3cb88">rand_dis</a>(gen));</div><div class="line">            <span class="keywordflow">if</span> (bv.<a name="a24"></a><a class="code" href="classbm_1_1bvector.html#abf474232920c5a01c88db1f85608b79b">test</a>(idx))  <span class="comment">// make sure benchmark example is not repeated</span></div><div class="line">                <span class="keywordflow">continue</span>;</div><div class="line">            <span class="keywordflow">if</span> (idx &lt; str_vec.size())</div><div class="line">                bench_vec.push_back(str_vec[idx]);</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        }</div><div class="line">        bv.<a name="a25"></a><a class="code" href="classbm_1_1bvector.html#ade3af299b53a3d50af720192aed04791">set</a>(idx); <span class="comment">// mark as set</span></div><div class="line">        </div><div class="line">        <span class="comment">// generate not-found case by modifying a letter in an existing sample</span></div><div class="line">        {</div><div class="line">            <span class="keywordtype">string</span> str_nf = str_vec[idx];</div><div class="line">            string::reverse_iterator rit = str_nf.rbegin();</div><div class="line">            string::reverse_iterator rit_end = str_nf.rend();</div><div class="line">            <span class="keywordflow">for</span> (; rit != rit_end; ++rit)</div><div class="line">            {</div><div class="line">                <span class="keywordtype">char</span> ch = *rit;</div><div class="line">                <span class="keywordtype">int</span> a = rand() % 26 + int(<span class="charliteral">&#39;A&#39;</span>); <span class="comment">// generate random letter</span></div><div class="line">                ch = char(a);</div><div class="line">                *rit = ch;</div><div class="line">                <span class="keyword">auto</span> it = <a name="a26"></a><a class="code" href="namespacebm.html#afa9134acef95e79cca3f711fbca4e38c">std::lower_bound</a>(str_vec.begin(), str_vec.end(), str_nf);</div><div class="line">                <span class="keywordflow">if</span> (it == str_vec.end() || *it != str_nf) <span class="comment">// check if not found</span></div><div class="line">                {</div><div class="line">                    bench_vec_not_found.push_back(str_nf);</div><div class="line">                    <span class="keywordflow">break</span>;</div><div class="line">                }</div><div class="line">            } <span class="comment">// for rit</span></div><div class="line">        }</div><div class="line">         </div><div class="line">    } <span class="comment">// for</span></div><div class="line">    cout &lt;&lt; endl;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span></div><div class="line"><span class="keywordtype">void</span> <a name="a27"></a><a class="code" href="xsample05_8cpp.html#ab52d93a56ae9c85e7724586e01c8d8e4">run_benchmark</a>(<span class="keyword">const</span> <a class="code" href="classbm_1_1str__sparse__vector.html">str_sparse_vect</a>&amp; str_sv, <span class="keyword">const</span> <a class="code" href="xsample05_8cpp.html#a8bf4fb8d6965a6d2b5da8c388f625171">string_vector</a>&amp; str_vec)</div><div class="line">{</div><div class="line">    <a class="code" href="xsample05_8cpp.html#a8bf4fb8d6965a6d2b5da8c388f625171">string_vector</a> bench_vec;</div><div class="line">    <a class="code" href="xsample05_8cpp.html#a8bf4fb8d6965a6d2b5da8c388f625171">string_vector</a> bench_vec_not_found; <span class="comment">// vector for impossible dictionary items</span></div><div class="line"></div><div class="line">    <a class="code" href="xsample05_8cpp.html#ab67e6b44ea8f9b8ae182b3e7173f1b51">pick_benchmark_set</a>(bench_vec, bench_vec_not_found, str_vec);</div><div class="line">    </div><div class="line">    <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a> bv1, bv2, bv3, bv4;</div><div class="line"></div><div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;Picked &quot;</span> &lt;&lt; bench_vec.<a name="a28"></a><a class="code" href="classbm_1_1bvector.html#a105aeb50ff3b085db6f592793914c9f9">size</a>() &lt;&lt; <span class="stringliteral">&quot; / &quot;</span> </div><div class="line">         &lt;&lt; bench_vec_not_found.size() &lt;&lt; <span class="stringliteral">&quot; samples. Running benchmarks.&quot;</span> </div><div class="line">         &lt;&lt; endl;</div><div class="line">    </div><div class="line">    <span class="keywordtype">unsigned</span> bench_size = unsigned(bench_vec.size());</div><div class="line">    {</div><div class="line">        {</div><div class="line">            <a class="code" href="classbm_1_1chrono__taker.html">bm::chrono_taker</a> tt1(<span class="stringliteral">&quot;3.  std::lower_bound() search&quot;</span>, bench_size, &amp;<a class="code" href="xsample05_8cpp.html#a6cb51d150528a5d2d87acb3e88f450bc">timing_map</a>);</div><div class="line">            <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; term : bench_vec)</div><div class="line">            {</div><div class="line">                <span class="keyword">auto</span> it = <a class="code" href="namespacebm.html#afa9134acef95e79cca3f711fbca4e38c">std::lower_bound</a>(str_vec.begin(), str_vec.end(), term);</div><div class="line">                <span class="keywordflow">if</span> (it != str_vec.end())</div><div class="line">                {</div><div class="line">                    string_vector::size_type idx =</div><div class="line">                        string_vector::size_type(std::distance(str_vec.begin(), it));</div><div class="line">                    bv1.<a class="code" href="classbm_1_1bvector.html#ade3af299b53a3d50af720192aed04791">set</a>(<span class="keywordtype">unsigned</span>(idx));</div><div class="line">                }</div><div class="line">            } <span class="comment">// for</span></div><div class="line">        }</div><div class="line">        {</div><div class="line">            <a class="code" href="classbm_1_1chrono__taker.html">bm::chrono_taker</a> tt2(<span class="stringliteral">&quot;3a. std::lower_bound() search (empty)&quot;</span>, bench_size, &amp;<a class="code" href="xsample05_8cpp.html#a6cb51d150528a5d2d87acb3e88f450bc">timing_map</a>);</div><div class="line">            <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; term : bench_vec_not_found)</div><div class="line">            {</div><div class="line">                <a class="code" href="namespacebm.html#afa9134acef95e79cca3f711fbca4e38c">std::lower_bound</a>(str_vec.begin(), str_vec.end(), term);</div><div class="line">            } <span class="comment">// for</span></div><div class="line">        }</div><div class="line">    }</div><div class="line">    </div><div class="line">    {</div><div class="line">        <span class="comment">// construct std::map&lt;&gt;  (RB-tree)</span></div><div class="line">        std::map&lt;string, unsigned&gt; str_map;</div><div class="line">        <span class="keywordflow">for</span> (string_vector::size_type i = 0; i &lt; str_vec.size(); ++i)</div><div class="line">        {</div><div class="line">            <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; s = str_vec[i];</div><div class="line">            str_map[s] = unsigned(i);</div><div class="line">        } <span class="comment">// for</span></div><div class="line">        {</div><div class="line">            <a class="code" href="classbm_1_1chrono__taker.html">bm::chrono_taker</a> tt1(<span class="stringliteral">&quot;4.  std::map&lt;&gt; search&quot;</span>, bench_size, &amp;<a class="code" href="xsample05_8cpp.html#a6cb51d150528a5d2d87acb3e88f450bc">timing_map</a>);</div><div class="line">            <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; term : bench_vec)</div><div class="line">            {</div><div class="line">                <span class="keyword">auto</span> it = str_map.find(term);</div><div class="line">                <span class="keywordflow">if</span> (it != str_map.end())</div><div class="line">                {</div><div class="line">                    bv2.<a class="code" href="classbm_1_1bvector.html#ade3af299b53a3d50af720192aed04791">set</a>(<span class="keywordtype">unsigned</span>(it-&gt;second));</div><div class="line">                }</div><div class="line">            } <span class="comment">// for</span></div><div class="line">        }</div><div class="line">        {</div><div class="line">            <a class="code" href="classbm_1_1chrono__taker.html">bm::chrono_taker</a> tt2(<span class="stringliteral">&quot;4a. std::map&lt;&gt; search (empty)&quot;</span>, bench_size, &amp;<a class="code" href="xsample05_8cpp.html#a6cb51d150528a5d2d87acb3e88f450bc">timing_map</a>);</div><div class="line">            <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; term : bench_vec_not_found)</div><div class="line">            {</div><div class="line">                <span class="keyword">auto</span> it = str_map.find(term);</div><div class="line">                <span class="keywordflow">if</span> (it != str_map.end())</div><div class="line">                {</div><div class="line">                    cerr &lt;&lt; <span class="stringliteral">&quot;empty search returned value...&quot;</span> &lt;&lt; endl;</div><div class="line">                }</div><div class="line">            } <span class="comment">// for</span></div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    {</div><div class="line">        <a name="_a29"></a><a class="code" href="classbm_1_1sparse__vector__scanner.html">bm::sparse_vector_scanner&lt;str_sparse_vect&gt;</a> scanner;</div><div class="line">        {</div><div class="line">            <a class="code" href="classbm_1_1chrono__taker.html">bm::chrono_taker</a> tt1(<span class="stringliteral">&quot;5.  bm::sparse_vector_scanner&lt;&gt; search&quot;</span>, bench_size, &amp;<a class="code" href="xsample05_8cpp.html#a6cb51d150528a5d2d87acb3e88f450bc">timing_map</a>);</div><div class="line">            <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; term : bench_vec)</div><div class="line">            {</div><div class="line">                <span class="keywordtype">unsigned</span> pos;</div><div class="line">                <span class="keywordtype">bool</span> found = scanner.<a name="a30"></a><a class="code" href="classbm_1_1sparse__vector__scanner.html#afd83dcdfba99e13a5d3fa5f26c4fbcbe">find_eq_str</a>(str_sv, term.c_str(), pos);</div><div class="line">                <span class="keywordflow">if</span> (found)</div><div class="line">                {</div><div class="line">                    bv3.<a class="code" href="classbm_1_1bvector.html#ade3af299b53a3d50af720192aed04791">set</a>(pos);</div><div class="line">                }</div><div class="line">            } <span class="comment">// for</span></div><div class="line">        }</div><div class="line">        {</div><div class="line">            <a class="code" href="classbm_1_1chrono__taker.html">bm::chrono_taker</a> tt1(<span class="stringliteral">&quot;5a. bm::sparse_vector_scanner&lt;&gt; search (empty)&quot;</span>, bench_size, &amp;<a class="code" href="xsample05_8cpp.html#a6cb51d150528a5d2d87acb3e88f450bc">timing_map</a>);</div><div class="line">            <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; term : bench_vec_not_found)</div><div class="line">            {</div><div class="line">                <span class="keywordtype">unsigned</span> pos;</div><div class="line">                <span class="keywordtype">bool</span> found = scanner.<a class="code" href="classbm_1_1sparse__vector__scanner.html#afd83dcdfba99e13a5d3fa5f26c4fbcbe">find_eq_str</a>(str_sv, term.c_str(), pos);</div><div class="line">                <span class="keywordflow">if</span> (found)</div><div class="line">                {</div><div class="line">                    cerr &lt;&lt; <span class="stringliteral">&quot;scanner empty search returned value...&quot;</span> &lt;&lt; endl;</div><div class="line">                }</div><div class="line">            } <span class="comment">// for</span></div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    {</div><div class="line">        <a class="code" href="classbm_1_1sparse__vector__scanner.html">bm::sparse_vector_scanner&lt;str_sparse_vect&gt;</a> scanner;</div><div class="line">        scanner.<a name="a31"></a><a class="code" href="classbm_1_1sparse__vector__scanner.html#aa5bd3464c5c0528ff168649413b5e7ee">bind</a>(str_sv, <span class="keyword">true</span>); <span class="comment">// attach SV as permanent search parameter to share cached values</span></div><div class="line"></div><div class="line">        {</div><div class="line">            <a class="code" href="classbm_1_1chrono__taker.html">bm::chrono_taker</a> tt1(<span class="stringliteral">&quot;6.  bm::sparse_vector_scanner&lt;&gt; binary search&quot;</span>, bench_size, &amp;<a class="code" href="xsample05_8cpp.html#a6cb51d150528a5d2d87acb3e88f450bc">timing_map</a>);</div><div class="line">            <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; term : bench_vec)</div><div class="line">            {</div><div class="line">                <span class="keywordtype">unsigned</span> pos;</div><div class="line">                <span class="keywordtype">bool</span> found = scanner.<a name="a32"></a><a class="code" href="classbm_1_1sparse__vector__scanner.html#ad78cd169e196875edd718e49b5b9ea42">bfind_eq_str</a>(term.c_str(), pos);</div><div class="line">                <span class="keywordflow">if</span> (found)</div><div class="line">                {</div><div class="line">                    bv4.<a class="code" href="classbm_1_1bvector.html#ade3af299b53a3d50af720192aed04791">set</a>(pos);</div><div class="line">                }</div><div class="line">            } <span class="comment">// for</span></div><div class="line">        }</div><div class="line">        {</div><div class="line">            <a class="code" href="classbm_1_1chrono__taker.html">bm::chrono_taker</a> tt2(<span class="stringliteral">&quot;6a. bm::sparse_vector_scanner&lt;&gt; binary search (empty)&quot;</span>, bench_size, &amp;<a class="code" href="xsample05_8cpp.html#a6cb51d150528a5d2d87acb3e88f450bc">timing_map</a>);</div><div class="line">            <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; term : bench_vec_not_found)</div><div class="line">            {</div><div class="line">                <span class="keywordtype">unsigned</span> pos;</div><div class="line">                <span class="keywordtype">bool</span> found = scanner.<a class="code" href="classbm_1_1sparse__vector__scanner.html#ad78cd169e196875edd718e49b5b9ea42">bfind_eq_str</a>(term.c_str(), pos);</div><div class="line">                <span class="keywordflow">if</span> (found)</div><div class="line">                {</div><div class="line">                    cerr &lt;&lt; <span class="stringliteral">&quot;scanner empty search returned value...&quot;</span> &lt;&lt; endl;</div><div class="line">                }</div><div class="line">            } <span class="comment">// for</span></div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// various integrity checks</span></div><div class="line">    <span class="comment">//</span></div><div class="line">    <span class="keywordtype">int</span> cmp = bv1.<a name="a33"></a><a class="code" href="classbm_1_1bvector.html#a38404509c80ec69e1075092f436a958e">compare</a>(bv2);</div><div class="line">    <span class="keywordflow">if</span> (cmp != 0)</div><div class="line">        <span class="keywordflow">throw</span> runtime_error(<span class="stringliteral">&quot;Error. RB-search mismatch!&quot;</span>);</div><div class="line">    cmp = bv1.<a class="code" href="classbm_1_1bvector.html#a38404509c80ec69e1075092f436a958e">compare</a>(bv3);</div><div class="line">    <span class="keywordflow">if</span> (cmp != 0)</div><div class="line">        <span class="keywordflow">throw</span> runtime_error(<span class="stringliteral">&quot;Error. scanner mismatch!&quot;</span>);</div><div class="line"></div><div class="line">    cmp = bv1.<a class="code" href="classbm_1_1bvector.html#a38404509c80ec69e1075092f436a958e">compare</a>(bv4);</div><div class="line">    <span class="keywordflow">if</span> (cmp != 0)</div><div class="line">        <span class="keywordflow">throw</span> runtime_error(<span class="stringliteral">&quot;Error. binary scanner mismatch!&quot;</span>);</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (bv1.<a name="a34"></a><a class="code" href="classbm_1_1bvector.html#ad012390ff13532528a8e25bf433de544">count</a>() != bench_size)</div><div class="line">        <span class="keywordflow">throw</span> runtime_error(<span class="stringliteral">&quot;Error. Search result missing elements!&quot;</span>);</div><div class="line"></div><div class="line"></div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a name="a35"></a><a class="code" href="xsample05_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span> (argc &lt; 3)</div><div class="line">    {</div><div class="line">        <a class="code" href="xsample05_8cpp.html#a81962ff36a3740bd2a6a458b74e57e26">show_help</a>();</div><div class="line">        <span class="keywordflow">return</span> 1;</div><div class="line">    }</div><div class="line"></div><div class="line">    <a class="code" href="xsample05_8cpp.html#a8bf4fb8d6965a6d2b5da8c388f625171">string_vector</a>      str_vec;  <span class="comment">// dictionary vector (STL)</span></div><div class="line">    <a class="code" href="classbm_1_1str__sparse__vector.html">str_sparse_vect</a>    str_sv;   <span class="comment">// bit-transposed sparse vector</span></div><div class="line"></div><div class="line">    <span class="keywordflow">try</span></div><div class="line">    {</div><div class="line">        <span class="keyword">auto</span> ret = <a class="code" href="xsample05_8cpp.html#a1c6cda197a32141227af69a440929ac6">parse_args</a>(argc, argv);</div><div class="line">        <span class="keywordflow">if</span> (ret != 0)</div><div class="line">        {</div><div class="line">            <span class="keywordflow">return</span> ret;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">if</span> (!<a class="code" href="xsample05_8cpp.html#ac7177de84eadf5aefd08c81cd1425d20">i_name</a>.empty())</div><div class="line">        {</div><div class="line">            <span class="keyword">auto</span> res = <a class="code" href="xsample05_8cpp.html#aa7970d5724e5b12f07307f86645d7214">load_dict_report</a>(<a class="code" href="xsample05_8cpp.html#ac7177de84eadf5aefd08c81cd1425d20">i_name</a>, str_vec);</div><div class="line">            <span class="keywordflow">if</span> (res != 0)</div><div class="line">            {</div><div class="line">                <span class="keywordflow">return</span> res;</div><div class="line">            }</div><div class="line">            cout &lt;&lt; <span class="stringliteral">&quot;Loaded &quot;</span> &lt;&lt; str_vec.size() &lt;&lt; <span class="stringliteral">&quot; dictionary names.&quot;</span> &lt;&lt; endl;</div><div class="line">            </div><div class="line">            std::sort(str_vec.begin(), str_vec.end());</div><div class="line">        }</div><div class="line">        </div><div class="line">        <span class="keywordflow">if</span> (str_vec.size()) <span class="comment">// load the sparse vector</span></div><div class="line">        {</div><div class="line">            <a class="code" href="classbm_1_1chrono__taker.html">bm::chrono_taker</a> tt1(<span class="stringliteral">&quot;2. build sparse vector&quot;</span>, 1, &amp;<a class="code" href="xsample05_8cpp.html#a6cb51d150528a5d2d87acb3e88f450bc">timing_map</a>);</div><div class="line"></div><div class="line">            <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; term : str_vec)</div><div class="line">                str_sv.<a name="a36"></a><a class="code" href="classbm_1_1str__sparse__vector.html#a7333e605d8ce5f5673a849695882fd58">push_back</a>(term);</div><div class="line">            </div><div class="line">            <span class="comment">// build remapped (dense) sparse vector</span></div><div class="line">            <span class="comment">// (this should be final), no more edits in this form</span></div><div class="line">            {</div><div class="line">                <a class="code" href="classbm_1_1str__sparse__vector.html">str_sparse_vect</a>    str_sv_remap;</div><div class="line">                str_sv_remap.<a name="a37"></a><a class="code" href="classbm_1_1str__sparse__vector.html#a37cb08354bd14dd1355bdeb5f18a140c">remap_from</a>(str_sv);</div><div class="line">                str_sv.<a name="a38"></a><a class="code" href="classbm_1_1str__sparse__vector.html#a49c03444a1678c14fb62e9505384aa8f">swap</a>(str_sv_remap);</div><div class="line">            }</div><div class="line">            </div><div class="line">            <a name="a39"></a><a class="code" href="bm_8h.html#ad9736d9521d713fa5d48859aa720bfdd">BM_DECLARE_TEMP_BLOCK</a>(tb)</div><div class="line">            str_sv.<a name="a40"></a><a class="code" href="classbm_1_1str__sparse__vector.html#a8f463b96e96c49e1b04705600730333f">optimize</a>(tb); <span class="comment">// memory optimization after load</span></div><div class="line">        }</div><div class="line">        </div><div class="line">        <span class="comment">// save SV vector to file</span></div><div class="line">        <span class="keywordflow">if</span> (!<a class="code" href="xsample05_8cpp.html#aaf0266ddaa79e04e2229808d9dabf477">sv_out_name</a>.empty() &amp;&amp; !str_sv.<a name="a41"></a><a class="code" href="classbm_1_1str__sparse__vector.html#a6170418aebf53a51475d4fafee7fb797">empty</a>())</div><div class="line">        {</div><div class="line">            <a class="code" href="classbm_1_1chrono__taker.html">bm::chrono_taker</a> tt1(<span class="stringliteral">&quot;7. Save sparse vector&quot;</span>, 1, &amp;<a class="code" href="xsample05_8cpp.html#a6cb51d150528a5d2d87acb3e88f450bc">timing_map</a>);</div><div class="line">            file_save_svector(str_sv, <a class="code" href="xsample05_8cpp.html#aaf0266ddaa79e04e2229808d9dabf477">sv_out_name</a>);</div><div class="line">        }</div><div class="line">        </div><div class="line">        <span class="keywordflow">if</span> (!<a class="code" href="xsample05_8cpp.html#a501736bde7958b6e05f5fa0f5ca954c1">sv_in_name</a>.empty())</div><div class="line">        {</div><div class="line">            {</div><div class="line">                <a class="code" href="classbm_1_1chrono__taker.html">bm::chrono_taker</a> tt1(<span class="stringliteral">&quot;8. Load sparse vector&quot;</span>, 1, &amp;<a class="code" href="xsample05_8cpp.html#a6cb51d150528a5d2d87acb3e88f450bc">timing_map</a>);</div><div class="line">                file_load_svector(str_sv, <a class="code" href="xsample05_8cpp.html#a501736bde7958b6e05f5fa0f5ca954c1">sv_in_name</a>);</div><div class="line">            }</div><div class="line">            <span class="keywordflow">if</span> (str_vec.empty())</div><div class="line">            {</div><div class="line">                <span class="keywordflow">for</span> (<a class="code" href="classbm_1_1str__sparse__vector.html#a3571a8772d22d500a0b06acf9fe00134">str_sparse_vect::size_type</a> i = 0; i &lt; str_sv.<a class="code" href="classbm_1_1str__sparse__vector.html#a8c07aff1f17d07156fc65c1d7d7436f5">size</a>(); ++i)</div><div class="line">                {</div><div class="line">                    <span class="keywordtype">string</span> s;</div><div class="line">                    str_sv.<a class="code" href="classbm_1_1str__sparse__vector.html#ac532119542ae9d702d2f26889f53384c">get</a>(i, s);</div><div class="line">                    str_vec.emplace_back(std::move(s));</div><div class="line">                } <span class="comment">// for</span></div><div class="line">            }</div><div class="line">        }</div><div class="line"></div><div class="line">        </div><div class="line">        <span class="keywordflow">if</span> (<a class="code" href="xsample05_8cpp.html#aa592d3fbead57ca8423ac5caaccada07">is_diag</a>)</div><div class="line">        {</div><div class="line">            <span class="keywordflow">if</span> (!str_sv.<a class="code" href="classbm_1_1str__sparse__vector.html#a6170418aebf53a51475d4fafee7fb797">empty</a>())</div><div class="line">            {</div><div class="line">                print_svector_stat(str_sv, <span class="keyword">true</span>);</div><div class="line">            }</div><div class="line">            </div><div class="line">            <span class="keywordflow">if</span> (str_vec.size())</div><div class="line">            {</div><div class="line">                <span class="keywordtype">size_t</span> total_size = 0;</div><div class="line">                <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; term : str_vec)</div><div class="line">                {</div><div class="line">                    total_size += term.size();</div><div class="line">                }</div><div class="line">                cout &lt;&lt; <span class="stringliteral">&quot;String dictionary size: &quot;</span></div><div class="line">                     &lt;&lt; total_size / 1024 &lt;&lt; <span class="stringliteral">&quot;KB (&quot;</span> &lt;&lt; total_size / (1024*1024) &lt;&lt; <span class="stringliteral">&quot;MB)&quot;</span></div><div class="line">                     &lt;&lt; endl;</div><div class="line">            }</div><div class="line">            </div><div class="line">            <span class="keywordflow">if</span> (str_sv.<a class="code" href="classbm_1_1str__sparse__vector.html#a8c07aff1f17d07156fc65c1d7d7436f5">size</a>() &amp;&amp; str_vec.size())</div><div class="line">            {</div><div class="line">                cout &lt;&lt; <span class="stringliteral">&quot;Run full comparison check...&quot;</span> &lt;&lt; endl;</div><div class="line">                <a class="code" href="xsample05_8cpp.html#aba487d142b2efb5cd5e143c7c9fa9c6a">check_sparse</a>(str_sv, str_vec); <span class="comment">// run a paranoiya check</span></div><div class="line">                cout &lt;&lt; <span class="stringliteral">&quot;Ok&quot;</span> &lt;&lt; endl;</div><div class="line">            }</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (<a class="code" href="xsample05_8cpp.html#a4dd1e4b402061691109d356faa4513b5">is_bench</a>) <span class="comment">// run set of benchmarks</span></div><div class="line">        {</div><div class="line">            <a class="code" href="xsample05_8cpp.html#ab52d93a56ae9c85e7724586e01c8d8e4">run_benchmark</a>(str_sv, str_vec);</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (<a class="code" href="xsample05_8cpp.html#aece8e90d91aaea144d41103f7d2825ee">is_timing</a>)  <span class="comment">// print all collected timings</span></div><div class="line">        {</div><div class="line">            std::cout &lt;&lt; std::endl &lt;&lt; <span class="stringliteral">&quot;Performance:&quot;</span> &lt;&lt; std::endl;</div><div class="line">            <a name="a42"></a><a class="code" href="classbm_1_1chrono__taker.html#a30b45453d952d14afe56c29087970899">bm::chrono_taker::print_duration_map</a>(<a class="code" href="xsample05_8cpp.html#a6cb51d150528a5d2d87acb3e88f450bc">timing_map</a>, <a name="a43"></a><a class="code" href="classbm_1_1chrono__taker.html#a9a41e5f2fe48ba472fd77a1dbd86457da82bf0167445f7cec0bb401145e8b0a5d">bm::chrono_taker::ct_time</a>);</div><div class="line">        }</div><div class="line">    }</div><div class="line">    <span class="keywordflow">catch</span> (std::exception&amp; ex)</div><div class="line">    {</div><div class="line">        std::cerr &lt;&lt; <span class="stringliteral">&quot;Error:&quot;</span> &lt;&lt; ex.what() &lt;&lt; std::endl;</div><div class="line">        <span class="keywordflow">return</span> 1;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div><div class="line"></div></div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
